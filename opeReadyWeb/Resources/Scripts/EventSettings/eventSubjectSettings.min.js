function deleteSpecFormatter(a, b, c) { var d; try { d = new Image(32, 32); if (!c.isBusy) { $(d).attr("src", "/opeReady/Resources/icons/trash.png"); $(d).attr("style", "cursor:pointer") } else { $(d).attr("src", "/opeReady/Resources/images/empty.png") } } catch (e) { } return d.outerHTML || (new XMLSerializer).serializeToString(d) } var rowCount; var eventSubject = {}; eventSubject.CreateEventSubjectsGrid = function (a) { var b; if ($.cookie("lang")) { if ($.cookie("lang") == "he-IL" || $.cookie("lang") == "ar") b = "rtl"; else b = "ltr" } $("#divDefineEventSubject").block({ css: { border: "0px" }, overlayCSS: { backgroundColor: "#ffffff", opacity: .7 }, message: "" }); $("#tblEventSubjects").jqGrid({ direction: b, datatype: function (b) { eventSubject.getEventSubjectData(a) }, height: 375, colNames: [$("#hidEventSubject_Grid_TrainingEventType_Name").text(), $("#hidEventSubject_Grid_TrainingEventCategory_Name").text(), "", "", "TrainingEventCategory_ID", "TrainingEventType_ID", ""], colModel: [{ name: "TrainingEventType_Name", index: "TrainingEventType_Name", sortable: true, sorttype: "text", width: 250 }, { name: "TrainingEventCategory_Name", index: "TrainingEventCategory_Name", sortable: true, sorttype: "text", width: 250 }, { name: "EditType", index: "EditType", sortable: false, edittype: "image", formatter: editFormatter, width: 35, align: "center" }, { name: "DelType", index: "DelType", sortable: false, edittype: "image", formatter: deleteSpecFormatter, width: 45, align: "center" }, { name: "TrainingEventCategory_ID", hidden: "true" }, { name: "TrainingEventType_ID", hidden: "true" }, { name: "isBusy", hidden: "true"}], viewrecords: true, sortorder: "asc", autoencode: false, loadonce: false, pginput: true, altRows: true, hoverrows: false, toolbar: [true, "top"], recordpos: b == "rtl" ? "left" : "right", pager: "#pgrEventSubjects", pgbuttons: false, pginput: false, gridComplete: function () { $(this).setGridParam({ datatype: "local", selarrrow: "false" }); if (rowCount == $(this).getGridParam("records")) { $("#waitplease").css({ display: "none" }); $("#divDefineEventSubject").unblock(); rowCount = 0 } }, onCellSelect: function (a, b, c, d) { switch (b) { case 2: eventSubject.DefineEventSubjectSetting_Open($(this).getRowData(a)); break; case 3: if ($(this).getRowData(a).isBusy == "false") return eventSubject.DefineEventSubjectSetting_Delete($(this).getRowData(a).TrainingEventCategory_ID); break } return false }, ondblClickRow: function (a, b, c, d) { eventSubject.DefineEventSubjectSetting_Open($(this).getRowData(a)) } }); $("#tblEventSubjects").jqGrid("gridResize", { minWidth: 750, minHeight: 300 }).toolbarButtonAdd("#t_tblEventSubjects", { caption: $("#hidEventSubjects_btnAddEventType").text(), position: "first", align: b == "rtl" ? "right" : "left", buttonicon: "ui-icon-circle-plus", onClickButton: function () { eventSubject.DefineEventSubjectsData_New() } }) }; eventSubject.getEventSubjectData = function (a) { PQ.Admin.WebService.EventTypeSettingsService.TrainingEventCategory_SelectAll(a, function (a, b) { eventSubject.ReceivedEventTypeSettingData(JSON.parse(getMain(a)).rows) }, function (a, b) { return false }) }; eventSubject.ReceivedEventTypeSettingData = function (a) { var b = $("#tblEventSubjects"); b.clearGridData(); rowCount = a.length; if (!rowCount) $("#divDefineEventSubject").unblock(); for (var c = 0; c < a.length; c++) b.addRowData(c + 1, a[c]) }; eventSubject.DefineEventSubjectsData_New = function () { $("#txtEventSubject").val(""); $("#ddlEventTypeDetails").val("0").show(); $("#txtEventTypeDetails").val("").hide(); $("#hidTrainingEventCategory_ID").val(""); $("#btnAddNewEventSubjects").val($("#lblEventSubject_btnAddNewEventSubjects").text()); divDefineEventSubjectsDetails_Open() }; eventSubject.DefineEventSubjectSetting_Open = function (a) { if (a) { $("#btnAddNewEventSubjects").val($("#lblEventSettings_btnUpdate").text()); $("#ddlEventTypeDetails").val(a.TrainingEventType_ID).hide(); $("#hidTrainingEventCategory_ID").val(a.TrainingEventCategory_ID); $("#txtEventTypeDetails").val(a.TrainingEventType_Name).show(); $("#txtEventSubject").val(a.TrainingEventCategory_Name) } divDefineEventSubjectsDetails_Open() }; eventSubject.SaveEventSubjectSettingData = function (a) { if (a) { PQ.Admin.WebService.EventTypeSettingsService.TrainingEventCategory_Save(a, function (b) { if (b) { $("#tblEventSubjects").GridUnload(); $("#ddlEventType").val(a.TrainingEventType_ID); eventSubject.CreateEventSubjectsGrid(a.TrainingEventType_ID); $("#divDefineEventSubjectsDetails").dialog("destroy") } $("#waitplease").css({ display: "none" }) }, function (a) { $("#waitplease").css({ display: "none" }) }) } }; eventSubject.DefineEventSubjectSetting_Delete = function (a) { if (a) { $("#ConfirmDeleteAttachment").dialog({ autoOpen: true, modal: true, resizable: false, closeOnEscape: true, height: 150, open: function (a, b) { $(this).parent().appendTo("form") }, buttons: { Ok: function (b) { b.preventDefault(); $("#waitplease").css({ display: "block" }); try { PQ.Admin.WebService.EventTypeSettingsService.TrainingEventCategory_Delete(a, function (a) { if (a) { $("#tblEventSubjects").GridUnload(); eventSubject.CreateEventSubjectsGrid($("#ddlEventType").val()); $("#waitplease").css({ display: "none" }); $("#ConfirmDeleteAttachment").dialog("destroy") } }, function (a) { $("#waitplease").css({ display: "none" }); $("#ConfirmDeleteAttachment").dialog("destroy"); return false }) } catch (b) { return false } return false }, Cancel: function (a) { a.preventDefault(); $(this).dialog("destroy"); return false } } }); return false } };eventSubject.DefineEventTypeSettingRequaredFields = function () { var a = new Boolean(true); var b = $("input:radio:checked").val(); if ($("#txtEventType").val() == "") { $("#txtEventType").addClass("ui-state-error").focus(); return false } else { $("#txtEventType").removeClass("ui-state-error", 500); a = true } if (b) { $("#divRadiobuttons").removeClass("ui-state-error"); a = true } else { $("#divRadiobuttons").addClass("ui-state-error"); return false } return a };