function beginRequestHandler() { } function endRequestHandler(a, b) { } function applicationLoadHandler() { adminAlert.Init() } var rowCount; var adminAlert = { rowCount: 0 }; adminAlert.Init = function () { }; adminAlert.CreateAdministrativeAlertGrid = function (a) { var b; if ($.cookie("lang")) { if ($.cookie("lang") == "he-IL" || $.cookie("lang") == "ar") b = "rtl"; else b = "ltr" } $("#divAdministrativeAlert").block({ css: { border: "0px" }, overlayCSS: { backgroundColor: "#ffffff", opacity: .7 }, message: "" }); $("#tblAdministrativeAlert").jqGrid({ direction: b, datatype: function (b) { adminAlert.getAdministrativeAlertData(a) }, height: 375, colNames: [$("#hidAdminAlert_Grid_Job_Name").text(), $("#hidAdminAlert_Grid_SubQualificationName").text(), $("#hidAdminAlert_Grid_ThresholdLevelInDays").text(), $("#hidAdminAlert_Grid_GraceInDays").text(), "", "", "Job_ID", "SubQualificationType_ID"], colModel: [{ name: "Job_Name", index: "Job_Name", sortable: true, sorttype: "text", width: 220 }, { name: "SubQualificationType_Name", index: "SubQualificationType_Name", sortable: true, sorttype: "text", width: 200 }, { name: "ThresholdLevelInDays", index: "ThresholdLevelInDays", sortable: true, sorttype: "int", align: "center", width: 100 }, { name: "GraceInDays", index: "GraceInDays", sorttype: "int", sortable: true, sorttype: "int", align: "center", width: 100 }, { name: "EditAlert", index: "EditAlert", sortable: false, edittype: "image", formatter: editFormatter, width: 35, align: "center" }, { name: "DelAlert", index: "DelAlert", sortable: false, edittype: "image", formatter: deleteFormatter, width: 45, align: "center" }, { name: "Job_ID", hidden: "true" }, { name: "SubQualificationType_ID", hidden: "true"}], viewrecords: true, sortorder: "asc", autoencode: false, loadonce: false, pginput: true, altRows: true, hoverrows: false, toolbar: [true, "top"], recordpos: b == "rtl" ? "left" : "right", pager: "#pgrAdministrativeAlert", pgbuttons: false, pginput: false, gridComplete: function () { $(this).setGridParam({ datatype: "local", selarrrow: "false" }); if (rowCount == $(this).getGridParam("records")) { $("#waitplease").css({ display: "none" }); $("#divAdministrativeAlert").unblock() } }, onCellSelect: function (a, b, c, d) { switch (b) { case 4: adminAlert.DefineAdministrativeAlert_Open($(this).getRowData(a)); break; case 5: return adminAlert.DefineAdministrativeAlert_Delete($(this).getRowData(a)); break } return false }, ondblClickRow: function (a, b, c, d) { adminAlert.DefineAdministrativeAlert_Open($(this).getRowData(a)) } }); $("#tblAdministrativeAlert").jqGrid("gridResize", { minWidth: 750, minHeight: 300 }).toolbarButtonAdd("#t_tblAdministrativeAlert", { caption: $("#hidAdminAlert_btnAddAdminAlert").text(), position: "first", align: b == "rtl" ? "right" : "left", buttonicon: "ui-icon-circle-plus", onClickButton: function () { adminAlert.DefineAdministrativeAlert_New() } }).jqGrid("sortGrid", "Job_Name", true) }; adminAlert.getAdministrativeAlertData = function (a) { PQ.Admin.WebService.AlertSettingService.AdministrativeAlert_SelectAll(a.Job_ID, function (a, b) { adminAlert.ReceivedAdministrativeAlertData(JSON.parse(getMain(a)).rows) }, function (a, b) { $("#divAdministrativeAlert").unblock(); return false }) }; adminAlert.ReceivedAdministrativeAlertData = function (a) { var b = $("#tblAdministrativeAlert"); b.clearGridData(); rowCount = a.length; if (!rowCount) $("#divAdministrativeAlert").unblock(); for (var c = 0; c < a.length; c++) b.addRowData(c + 1, a[c]) }; adminAlert.DefineAdministrativeAlert_New = function () { $("#ddlJobs").val("0").show(); $("#txtJobs").val("").hide(); $("#ddlSubQualification").val("0").show(); $("#txtSubQualification").val("").hide(); $("#txtThresholdLevelInDays").val(""); $("#txtGraceInDay").val(""); $("#txtAlertInDay").val(""); $("#btnAddReadinessAlert").val($("#lblReadinessAlert_btnAddAlert").text()); divAdminAlertDetails_Open() }; adminAlert.DefineAdministrativeAlert_Delete = function (a) { if (a) { $("#ConfirmDeleteAttachment").dialog({ autoOpen: true, modal: true, resizable: false, closeOnEscape: true, height: 150, open: function (a, b) { $(this).parent().appendTo("form") }, buttons: { Ok: function (b) { b.preventDefault(); $("#waitplease").css({ display: "block" }); try { PQ.Admin.WebService.AlertSettingService.AdministrativeAlert_Delete(a.Job_ID, a.SubQualificationType_ID, function (a) { if (a) { $("#tblAdministrativeAlert").GridUnload(); adminAlert.CreateAdministrativeAlertGrid({ Job_ID: $("#ddlJobsList").val() }); $("#waitplease").css({ display: "none" }); $("#ConfirmDeleteAttachment").dialog("destroy") } }, function (a) { $("#waitplease").css({ display: "none" }); $("#ConfirmDeleteAttachment").dialog("destroy"); return false }) } catch (b) { return false } return false }, Cancel: function (a) { a.preventDefault(); $(this).dialog("destroy"); return false } } }) } return false }; adminAlert.DefineAdministrativeAlert_Save = function () { if (adminAlert.AdminAlertRequaredFields()) { $("#waitplease").css({ display: "block" }); var a = { Job_ID: $("#ddlJobs").val(), SubQualificationType_ID: $("#ddlSubQualification").val(), ThresholdLevelInDays: $("#txtThresholdLevelInDays").val(), GraceInDays: $("#txtGraceInDay").val(), AlertInDays: $("#txtAlertInDay").val() }; PQ.Admin.WebService.AlertSettingService.AdministrativeAlert_Save(a, function (a) { if (a) { $("#tblAdministrativeAlert").GridUnload(); adminAlert.CreateAdministrativeAlertGrid({ Job_ID: $("#ddlJobsList").val() }); $("#waitplease").css({ display: "none" }); $("#divAdminAlertDetails").dialog("destroy") } }, function (a) { $("#waitplease").css({ display: "none" }); return false }) } }; adminAlert.DefineAdministrativeAlert_Open = function (a) { if (a) { $("#btnAddReadinessAlert").val($("#lblReadinessAlert_btnUpdate").text()); PQ.Admin.WebService.AlertSettingService.AdministrativeAlert_Select(a.Job_ID, a.SubQualificationType_ID, function (a) { if (a) { $("#ddlJobs").val(a.Job_ID).hide(); $("#txtJobs").val($("#ddlJobs option:selected").text()).show(); $("#ddlSubQualification").val(a.SubQualificationType_ID).hide(); $("#txtSubQualification").val(a.SubQualificationType_Name).show(); $("#txtThresholdLevelInDays").val(a.ThresholdLevelInDays); $("#txtGraceInDay").val(a.GraceInDays); $("#txtAlertInDay").val(a.AlertInDays) } divAdminAlertDetails_Open() }, function (a) { return false }) } }; adminAlert.AdminAlertRequaredFields = function () { var a = new Boolean(true); if ($("#ddlJobs").val() == "0") { $("#ddlJobs").addClass("ui-state-error"); return false } else { $("#ddlJobs").removeClass("ui-state-error", 200); a = true } if ($("#ddlSubQualification").val() == "0") { $("#ddlSubQualification").addClass("ui-state-error"); return false } else { $("#ddlSubQualification").removeClass("ui-state-error", 200); a = true } if ($("#txtThresholdLevelInDays").val() == "") { $("#txtThresholdLevelInDays").addClass("ui-state-error"); return false } else { $("#txtThresholdLevelInDays").removeClass("ui-state-error", 200); a = true } return a }; Sys.Application.add_load(applicationLoadHandler); Sys.WebForms.PageRequestManager.getInstance().add_endRequest(endRequestHandler); Sys.WebForms.PageRequestManager.getInstance().add_beginRequest(beginRequestHandler)